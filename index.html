<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balança Rodoviária Pro+</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema completo de gestão de pesagem rodoviária">
    <meta name="theme-color" content="#0d9488">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Balança Pro+">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon-192.svg">
    <link rel="apple-touch-icon" href="icon-192.svg">
    
    <!-- Nota: Para produção, instale Tailwind localmente: npm install -D tailwindcss -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <!-- Tela de Autenticação -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-card glass-card animate-scale-in">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">⚖️ Balança Pro+</h1>
                <p class="text-gray-600">Sistema de Pesagem Rodoviária</p>
            </div>
            
            <!-- Login Form -->
            <form id="form-login" class="space-y-4">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">📧 Email</label>
                    <input type="email" id="login-email" required autocomplete="email" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="seu@email.com">
                </div>
                
                <div class="relative">
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">🔒 Senha</label>
                    <input type="password" id="login-password" required autocomplete="current-password"
                           class="w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="••••••••">
                    <span class="password-toggle" onclick="togglePasswordVisibility('login-password')">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </span>
                </div>
                
                <button type="submit" id="btn-login" class="w-full btn-primary text-white font-semibold py-3 rounded-lg transition-all">
                    🚀 Entrar
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <button type="button" id="btn-show-register" class="text-sm text-accent hover:underline font-medium">
                    Não tem conta? Registrar-se
                </button>
            </div>
            
            <!-- Register Form (Hidden Initially) -->
            <form id="form-register" class="space-y-4 hidden">
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">📝 Criar Nova Conta</h2>
                    <p class="text-sm text-gray-600">Preencha os dados abaixo</p>
                </div>
                
                <div>
                    <label for="register-nome" class="block text-sm font-medium text-gray-700 mb-1">👤 Nome Completo</label>
                    <input type="text" id="register-nome" required 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="Seu nome completo">
                </div>
                
                <div>
                    <label for="register-email" class="block text-sm font-medium text-gray-700 mb-1">📧 Email</label>
                    <input type="email" id="register-email" required autocomplete="email"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="seu@email.com">
                </div>
                
                <div class="relative">
                    <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">🔒 Senha</label>
                    <input type="password" id="register-password" required autocomplete="new-password" minlength="6"
                           class="w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="Mínimo 6 caracteres">
                    <span class="password-toggle" onclick="togglePasswordVisibility('register-password')">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </span>
                </div>
                
                <div class="relative">
                    <label for="register-password-confirm" class="block text-sm font-medium text-gray-700 mb-1">🔒 Confirmar Senha</label>
                    <input type="password" id="register-password-confirm" required autocomplete="new-password" minlength="6"
                           class="w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                           placeholder="Digite a senha novamente">
                </div>
                
                <button type="submit" id="btn-register" class="w-full btn-primary text-white font-semibold py-3 rounded-lg transition-all">
                    ✅ Criar Conta
                </button>
                
                <button type="button" id="btn-back-to-login" class="w-full bg-gray-200 text-gray-800 font-semibold py-3 rounded-lg hover:bg-gray-300 transition-all">
                    ← Voltar ao Login
                </button>
            </form>
        </div>
    </div>

    <div id="loading-overlay">
        <div class="text-center">
            <svg class="animate-spin h-8 w-8 text-teal-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <p class="mt-2 text-gray-600">A carregar dados da nuvem...</p>
        </div>
    </div>

    <main class="max-w-7xl mx-auto opacity-0 transition-opacity duration-500" id="app-container" style="display:none">
        <header class="flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6">
            <div class="flex items-center gap-4">
                <div id="header-logo-container" class="flex items-center justify-center h-12 w-12 bg-gray-200 rounded-lg shadow-md overflow-hidden">
                    <img id="header-logo" src="" alt="Logo" class="hidden h-full w-full object-contain">
                    <svg id="header-default-icon" class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                </div>
                <div>
                    <h1 id="header-nome-empresa" class="text-xl sm:text-2xl font-bold text-gray-800">Sua Empresa</h1>
                    <p class="text-sm text-gray-500">Sistema de Controle de Balança</p>
                </div>
            </div>
             <div class="flex items-center gap-4">
                <div id="connection-status" class="flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-gray-800 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition shadow-md border border-gray-200 dark:border-gray-700" title="Clique para ver estatísticas" onclick="App.mostrarEstatisticasCache()">
                    <div id="status-dot" class="w-2.5 h-2.5 rounded-full bg-gray-400 transition-colors animate-pulse"></div>
                    <span id="status-text" class="font-medium text-gray-800 dark:text-gray-100">A Conectar...</span>
                    <span id="cache-badge" class="ml-1 text-base hidden">💾</span>
                </div>
                
                <!-- User Info -->
                <div class="flex items-center gap-3 border-l border-gray-300 pl-4">
                    <div class="text-right hidden sm:block">
                        <p id="user-name-display" class="font-semibold text-gray-800 text-sm"></p>
                        <div id="user-role-badge"></div>
                    </div>
                    <button id="btn-logout" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50 transition-colors" title="Sair">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
                
                <button id="btn-install-pwa" onclick="installPWA()" class="hidden no-print self-start sm:self-center bg-gradient-to-r from-green-500 to-teal-600 text-white font-semibold px-5 py-2.5 rounded-lg hover:from-green-600 hover:to-teal-700 shadow-lg hover:shadow-xl transition-all flex items-center gap-2 animate-pulse" title="Instalar App">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span class="hidden md:inline">📥 Instalar App</span>
                    <span class="md:hidden">📥</span>
                </button>
                
                <div id="btn-dark-mode" onclick="toggleDarkMode()" class="dark-mode-toggle no-print" title="Alternar Modo Escuro"></div>
                
                <button id="btn-info-dev" class="no-print self-start sm:self-center text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 p-2.5 rounded-full shadow-lg hover:shadow-xl transition-all" title="Informações do Desenvolvedor">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
                
                <button id="btn-toggle-config" class="dono-only no-print self-start sm:self-center text-white bg-purple-500 hover:bg-purple-600 dark:bg-purple-600 dark:hover:bg-purple-700 p-2.5 rounded-full shadow-lg hover:shadow-xl transition-all" title="Configurações">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0 3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                </button>
            </div>
        </header>

        <div id="modal-admin-login" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content glass-modal animate-scale-in bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
                <h3 class="text-lg font-bold text-gray-800 text-center mb-4">Acesso de Operador</h3>
                <form id="form-admin-login">
                    <label for="admin-password" class="block text-sm font-medium text-gray-700">Senha</label>
                    <input type="password" id="admin-password" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required>
                    <p id="login-error-msg" class="text-red-500 text-sm mt-1 h-4"></p>
                    <div class="flex justify-end gap-3 mt-4">
                        <button type="button" id="btn-cancel-login" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="btn-primary text-white font-semibold py-2 px-6 rounded-md">Entrar</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="modal-config" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-lg relative overflow-y-auto max-h-[90vh]">
                <button id="btn-fechar-config" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                <h2 class="text-xl font-bold text-gray-800 mb-4">Configurações e Branding</h2>
                <div class="space-y-4">
                    <div><label for="config-nome-empresa" class="block text-sm font-medium text-gray-700">Nome da Empresa</label><input type="text" id="config-nome-empresa" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                    <div><label for="config-cnpj" class="block text-sm font-medium text-gray-700">CNPJ</label><input type="text" id="config-cnpj" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                    <div><label for="config-footer" class="block text-sm font-medium text-gray-700">Texto do Rodapé (para tickets)</label><input type="text" id="config-footer" placeholder="Endereço, Telefone, Website" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                    <div><label for="config-password" class="block text-sm font-medium text-gray-700">Senha de Operador</label><input type="password" id="config-password" placeholder="Deixe em branco para não exigir senha" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                    <div class="flex items-center gap-4">
                        <label for="config-color" class="block text-sm font-medium text-gray-700">Cor Principal</label>
                        <input type="color" id="config-color" class="h-10 w-10 p-1 border border-gray-300 rounded-md cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Logotipo da Empresa</label>
                        <input type="file" id="config-logo-upload" accept="image/*" class="mt-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200">
                        <div id="logo-preview-container" class="mt-2 hidden items-center gap-4">
                            <img id="logo-preview" src="" class="logo-preview border p-1 rounded-md">
                            <button id="btn-remove-logo" class="text-xs text-red-600 hover:underline">Remover Logo</button>
                        </div>
                    </div>
                    <div class="border-t pt-4 mt-4 space-y-4">
                        <h3 class="text-lg font-semibold text-gray-800">Gestão de Dados</h3>
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Exporte todos os dados para um ficheiro JSON.</p>
                            <button id="btn-exportar-backup" class="w-full inline-flex items-center justify-center gap-2 bg-gray-700 text-white font-semibold py-2 px-4 rounded-md hover:bg-gray-800">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                📤 Exportar Backup (JSON)
                            </button>
                        </div>
                        <div class="bg-red-50 border border-red-200 p-3 rounded-lg">
                             <p class="text-sm text-red-800 font-semibold mb-2">Atenção: A importação irá substituir TODOS os dados atuais.</p>
                             <button id="btn-importar-backup" class="w-full inline-flex items-center justify-center gap-2 bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700">
                                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                 📥 Importar Backup
                            </button>
                             <input type="file" id="backup-file-input" class="hidden" accept=".json">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-confirm-restore" class="modal fixed inset-0 bg-black bg-opacity-60 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md text-center">
                <h3 class="text-xl font-bold text-red-700">Ação Irreversível</h3>
                <p class="text-gray-600 my-4">Para confirmar a sobrescrita de TODOS os dados, digite <strong class="text-red-700">SOBRESCREVER</strong> abaixo.</p>
                <input type="text" id="restore-confirm-input" class="mt-1 w-full p-2 border border-gray-300 rounded-md text-center uppercase" placeholder="SOBRESCREVER">
                <div class="flex justify-center gap-4 mt-6">
                    <button id="btn-cancel-restore" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-md hover:bg-gray-300">Cancelar</button>
                    <button id="btn-confirm-restore" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-red-700 disabled:bg-gray-400" disabled>Confirmar</button>
                </div>
            </div>
        </div>
        <div id="modal-ticket" class="modal fixed inset-0 bg-black bg-opacity-60 z-40 items-center justify-center p-4">
            <div class="modal-content bg-gray-50 rounded-lg shadow-2xl w-full max-w-4xl flex flex-col max-h-[90vh]">
                 <button id="btn-fechar-ticket" class="absolute top-2 right-4 text-gray-400 hover:text-gray-600 text-3xl leading-none z-10 no-print">&times;</button>
                <div id="ticket-imprimivel-container" class="p-4 sm:p-6 overflow-y-auto"></div>
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 p-4 no-print border-t border-gray-200 mt-auto bg-white rounded-b-lg">
                    <div class="flex items-center gap-2">
                        <label for="select-ticket-size" class="text-sm font-semibold text-gray-700">📏 Tamanho:</label>
                        <select id="select-ticket-size" class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent">
                            <option value="a4">A4 (210mm x 297mm)</option>
                            <option value="a5" selected>A5 (148mm x 210mm)</option>
                            <option value="termica">Térmica 80mm</option>
                        </select>
                    </div>
                    <div class="flex gap-4">
                        <button id="btn-imprimir" class="inline-flex items-center gap-2 bg-slate-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-slate-700 transition-colors">🖨️ Imprimir</button>
                        <button id="btn-baixar-ticket-pdf" class="btn-primary inline-flex items-center gap-2 text-white font-semibold py-2 px-6 rounded-md transition-all">📥 Baixar PDF</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-edit-ticket" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Alterar Ticket</h2>
                <form id="form-edit-ticket" class="space-y-4"></form>
            </div>
        </div>
        <div id="modal-confirm-delete" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
                <h3 class="text-lg font-bold text-gray-800">Confirmar Exclusão</h3>
                <p class="text-gray-600 my-4">Tem a certeza de que quer apagar este ticket? Esta ação é irreversível.</p>
                <div class="flex justify-center gap-4">
                    <button id="btn-cancel-delete" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-md hover:bg-gray-300">Cancelar</button>
                    <button id="btn-confirm-delete" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-red-700">Apagar</button>
                </div>
            </div>
        </div>
        <div id="modal-notification" class="modal fixed inset-0 bg-black bg-opacity-20 z-50 items-start justify-center pt-20 p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
                <p id="notification-message" class="text-gray-700 my-4">Mensagem aqui.</p>
                <div id="notification-actions" class="flex justify-center flex-wrap gap-3 mt-4"></div>
            </div>
        </div>
        <div id="modal-programacao" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-xl max-h-[90vh] overflow-y-auto p-6 relative">
                <button id="btn-close-programacao" class="absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                <h2 id="programacao-modal-title" class="text-xl font-bold text-gray-800 mb-4">Nova Instrução</h2>
                <form id="form-programacao" class="space-y-4">
                    <div>
                        <label for="programacao-data-modal" class="block text-sm font-medium text-gray-700">📅 Data</label>
                        <input type="date" id="programacao-data-modal" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm bg-gray-100" readonly>
                    </div>
                    <div>
                        <label for="programacao-produto" class="block text-sm font-medium text-gray-700">📦 Produto</label>
                        <select id="programacao-produto" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm" required>
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div>
                        <label for="programacao-destino" class="block text-sm font-medium text-gray-700">🏗️ Destino/Obra</label>
                        <select id="programacao-destino" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="programacao-quantidade" class="block text-sm font-medium text-gray-700">⚖️ Quantidade</label>
                            <input type="number" step="0.01" min="0" id="programacao-quantidade" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm" placeholder="Ex: 4">
                        </div>
                        <div>
                            <label for="programacao-unidade" class="block text-sm font-medium text-gray-700">📏 Unidade</label>
                            <input type="text" id="programacao-unidade" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm" placeholder="Ex: viagens, m³, t">
                        </div>
                    </div>
                    <div>
                        <label for="programacao-observacao" class="block text-sm font-medium text-gray-700">📝 Observações</label>
                        <textarea id="programacao-observacao" rows="3" class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm" placeholder="Detalhes adicionais (opcional)"></textarea>
                    </div>
                    <div class="flex justify-end gap-3 pt-2">
                        <button type="button" id="btn-cancel-programacao" class="rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100">Cancelar</button>
                        <button type="submit" class="btn-primary rounded-md px-4 py-2 text-sm font-semibold text-white">💾 Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Informações do Desenvolvedor -->
        <div id="modal-info-dev" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
            <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-teal-500 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">💻 Desenvolvedor</h3>
                    <p class="text-gray-600 text-sm">Sistema desenvolvido por</p>
                </div>
                
                <div class="space-y-4 bg-gray-50 rounded-lg p-5 mb-6">
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-semibold">Nome</p>
                            <p class="font-semibold text-gray-800">Eullon Oliveira Da Silva</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-semibold">Email</p>
                            <a href="mailto:eullon1234@gmail.com" class="font-semibold text-green-600 hover:text-green-700 hover:underline">
                                eullon1234@gmail.com
                            </a>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all">
                        <div class="w-10 h-10 bg-teal-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-teal-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-semibold">WhatsApp</p>
                            <a href="https://wa.me/5586994471909" target="_blank" class="font-semibold text-teal-600 hover:text-teal-700 hover:underline">
                                (86) 99447-1909
                            </a>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all">
                        <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-pink-600" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-semibold">Instagram</p>
                            <a href="https://instagram.com/eu.llon" target="_blank" class="font-semibold text-pink-600 hover:text-pink-700 hover:underline">
                                @eu.llon
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <p class="text-xs text-gray-500 mb-4">
                        ⚖️ Sistema de Balança Rodoviária Pro+ v1.3<br>
                        Desenvolvido com ❤️ e muito ☕
                    </p>
                    <button id="btn-close-info-dev" class="w-full bg-gradient-to-r from-teal-500 to-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-teal-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                        ✓ Fechar
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
            <div id="programacao-dia-card" class="mb-6 rounded-xl border border-teal-200 bg-teal-50 p-4 sm:p-6 shadow-inner">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <p class="text-xs font-semibold uppercase tracking-wide text-teal-700">📋 Programação do Dia</p>
                        <h3 id="programacao-dia-data-label" class="text-2xl font-bold text-gray-900 mt-1">&nbsp;</h3>
                        <p id="programacao-dia-meta" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                        <input type="date" id="programacao-dia-data" class="w-full sm:w-auto rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-teal-500 focus:ring-2 focus:ring-teal-500/40">
                        <button id="btn-programacao-add" class="hidden w-full sm:w-auto rounded-lg bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500/50">
                            ➕ Nova Instrução
                        </button>
                    </div>
                </div>
                <div id="programacao-dia-sem-permissao" class="mt-4 hidden rounded-lg border border-dashed border-yellow-400 bg-yellow-50 p-3 text-sm text-yellow-800">
                    Apenas usuários autorizados podem atualizar a programação. Solicite acesso ao proprietário.
                </div>
                <div id="programacao-dia-lista" class="mt-4 space-y-3">
                    <div class="rounded-lg border border-dashed border-gray-300 bg-white p-4 text-center text-sm text-gray-500">
                        Carregando programação...
                    </div>
                </div>
            </div>
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex flex-wrap gap-x-6" aria-label="Tabs">
                    <button class="tab-button operador-only" data-tab="entrada">📥 Entrada</button>
                    <button class="tab-button operador-only" data-tab="saida">📤 Saída</button>
                    <button class="tab-button visualizador-only hidden" data-tab="visualizador">👁️ Pátio</button>
                    <button class="tab-button" data-tab="tickets">🎫 Tickets</button>
                    <button class="tab-button" data-tab="relatorios">📊 Relatório Geral</button>
                    <button class="tab-button" data-tab="dashboard">📈 Dashboard</button>
                    <button class="tab-button operador-only" data-tab="cadastros">📋 Cadastros</button>
                    <button class="tab-button dono-only" data-tab="usuarios">👥 Usuários</button>
                    <button class="tab-button dono-only" data-tab="atividades">👁️ Atividades</button>
                </nav>
            </div>

            <div id="tab-content-visualizador" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-4">👁️ Monitoramento do Pátio</h2>
                <div class="bg-gradient-to-r from-teal-50 to-blue-50 border border-teal-100 rounded-xl p-4 sm:p-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <p class="text-xs font-semibold uppercase tracking-wide text-teal-700">Veículos aguardando saída</p>
                        <h3 id="visualizador-resumo-total" class="text-3xl font-bold text-teal-800 mt-1">0</h3>
                    </div>
                    <p class="text-sm text-teal-700">Atualizado em tempo real com as entradas registradas na balança.</p>
                </div>
                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="visualizador-pesquisa-placa" class="text-sm font-medium text-gray-700">🔍 Filtrar veículos</label>
                        <input type="search" id="visualizador-pesquisa-placa" placeholder="Placa, motorista ou nota fiscal..." class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="visualizador-ordenacao" class="text-sm font-medium text-gray-700">📊 Ordenar por</label>
                        <select id="visualizador-ordenacao" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            <option value="entrada-recente">Entrada mais recente</option>
                            <option value="entrada-antiga">Entrada mais antiga (Prioridade)</option>
                            <option value="produto">Produto (A-Z)</option>
                            <option value="placa">Placa (A-Z)</option>
                            <option value="tempo-patio">Mais tempo no pátio</option>
                        </select>
                    </div>
                </div>
                <div id="visualizador-lista-pendentes" class="mt-6 space-y-4">
                    <div class="text-center text-gray-500 py-8 border border-dashed border-gray-300 rounded-lg bg-gray-50">
                        Carregando veículos aguardando saída...
                    </div>
                </div>
            </div>

            <div id="tab-content-entrada" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-4">📥 Registrar Entrada de Veículo</h2>
                <form id="form-entrada" class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div><label for="entrada-placa" class="text-sm font-medium text-gray-700">🚗 Placa</label><input type="text" id="entrada-placa" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required maxlength="7" style="text-transform:uppercase"></div>
                        <div><label for="entrada-motorista" class="text-sm font-medium text-gray-700">👤 Motorista</label><input type="text" id="entrada-motorista" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required></div>
                        <div><label for="entrada-nf" class="text-sm font-medium text-gray-700">📄 Nota Fiscal</label><input type="text" id="entrada-nf" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                        <div><label for="entrada-peso-nota" class="text-sm font-medium text-gray-700">⚖️ Peso da Nota (kg) <span class="text-gray-400">(Opcional)</span></label><input type="number" step="0.01" id="entrada-peso-nota" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></div>
                        <div><label for="entrada-produto" class="text-sm font-medium text-gray-700">📦 Produto</label><select id="entrada-produto" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required></select></div>
                        <div><label for="entrada-obra" class="text-sm font-medium text-gray-700">🏗️ Obra</label><select id="entrada-obra" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required></select></div>
                        <div><label for="entrada-cliente" class="text-sm font-medium text-gray-700">🏢 Cliente/Fornecedor</label><select id="entrada-cliente" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required></select></div>
                        <div><label for="entrada-transpoSrtadora" class="text-sm font-medium text-gray-700">🚛 Transportadora</label><select id="entrada-transportadora" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select></div>
                        <div><label for="entrada-razao-social" class="text-sm font-medium text-gray-700">🏛️ Razão Social</label><select id="entrada-razao-social" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select></div>
                    </div>
                    <div id="entrada-programacao-sugestoes" class="hidden rounded-lg border border-teal-200 bg-teal-50/80 p-4 transition-all">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3">
                            <p id="entrada-programacao-sugestoes-titulo" class="text-sm font-semibold text-teal-900">Sugestões da programação</p>
                            <button type="button" id="btn-programacao-sugestoes-refresh" class="inline-flex items-center gap-2 self-start sm:self-auto rounded-md border border-teal-300 bg-white px-3 py-1.5 text-xs font-semibold text-teal-700 shadow-sm hover:bg-teal-100 focus:outline-none focus:ring-2 focus:ring-teal-500/40">
                                🔄 Atualizar
                            </button>
                        </div>
                        <div id="entrada-programacao-sugestoes-lista" class="space-y-3 text-sm text-teal-900"></div>
                    </div>
                    <div class="flex items-center gap-2">
                        <input id="entrada-has-nf2" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent">
                        <label for="entrada-has-nf2" class="text-sm text-gray-900">➕ Adicionar 2ª Nota Fiscal (Carreta)</label>
                    </div>
                    <div id="container-nf2" class="hidden space-y-1">
                        <label for="entrada-nf2" class="text-sm font-medium text-gray-700">📄 2ª Nota Fiscal</label>
                        <input type="text" id="entrada-nf2" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                     <div class="mt-4">
                        <label for="entrada-observacao" class="text-sm font-medium text-gray-700">📝 Observação (Opcional)</label>
                        <textarea id="entrada-observacao" rows="2" class="mt-1 w-full p-2 border border-gray-300 rounded-md" placeholder="Qualquer informação adicional..."></textarea>
                    </div>
                    <div class="border-t border-gray-200 pt-6 space-y-4">
                         <div class="flex items-center">
                            <input id="check-pesagem-dupla" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent">
                            <label for="check-pesagem-dupla" class="ml-2 block text-sm text-gray-900">Pesagem Dupla (Eixos Separados)</label>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="entrada-peso1-eixo1" class="text-sm font-medium text-gray-700">⚖️ 1ª Pesagem (kg)</label>
                                <input type="number" step="0.01" id="entrada-peso1-eixo1" class="mt-1 w-full p-2 border border-gray-300 rounded-md" required>
                            </div>
                             <div id="container-peso1-eixo2" class="hidden">
                                <label for="entrada-peso1-eixo2" class="text-sm font-medium text-gray-700">⚖️ 1ª Pesagem - Eixo 2 (kg)</label>
                                <input type="number" step="0.01" id="entrada-peso1-eixo2" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 pt-4">
                        <button type="submit" class="btn-primary inline-flex items-center justify-center gap-2 w-full sm:w-auto text-white font-semibold py-2 px-4 rounded-md transition-all">💾 Salvar Entrada</button>
                    </div>
                </form>
            </div>
            
            <div id="tab-content-saida" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-4">📤 Registrar Saída de Veículo</h2>
                <div><label for="saida-pesquisa-placa" class="text-sm font-medium text-gray-700">🔍 Pesquisar Placa</label><input type="search" id="saida-pesquisa-placa" class="mt-1 w-full p-2 border border-gray-300 rounded-md" placeholder="Digite a placa para encontrar..."></div>
                <div id="lista-pendentes" class="mt-4 space-y-2"></div>
                <div id="form-saida-container" class="mt-6 border-t border-gray-200 pt-6 hidden">
                    <form id="form-saida" class="space-y-4"></form>
                </div>
            </div>

            <div id="tab-content-tickets" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Tickets Finalizados</h2>
                      <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
                        <div>
                            <label for="filtro-ticket-data-inicio" class="text-sm font-medium text-gray-700">📅 Data Início</label>
                            <input type="date" id="filtro-ticket-data-inicio" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-ticket-data-fim" class="text-sm font-medium text-gray-700">📅 Data Fim</label>
                            <input type="date" id="filtro-ticket-data-fim" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-ticket-cliente" class="text-sm font-medium text-gray-700">🏢 Cliente/Forn.</label>
                            <select id="filtro-ticket-cliente" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-ticket-obra" class="text-sm font-medium text-gray-700">🏗️ Obra</label>
                            <select id="filtro-ticket-obra" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-ticket-produto" class="text-sm font-medium text-gray-700">📦 Produto</label>
                            <select id="filtro-ticket-produto" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-ticket-transportadora" class="text-sm font-medium text-gray-700">🚛 Transportadora</label>
                            <select id="filtro-ticket-transportadora" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div class="lg:col-span-3">
                             <label for="filtro-ticket-pesquisa" class="text-sm font-medium text-gray-700">🔍 Pesquisa</label>
                             <input type="search" id="filtro-ticket-pesquisa" placeholder="Nº Ticket ou Placa..." class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="lg:col-span-2 flex items-end gap-3">
                             <button id="btn-limpar-filtros-ticket" class="w-full bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300" title="Limpar Filtros">
                                🔄 Limpar Filtros
                            </button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto"><table class="min-w-full text-sm"><thead class="bg-gray-50"><tr><th class="p-3 text-left">Nº</th><th class="p-3 text-left">Data</th><th class="p-3 text-left">Placa</th><th class="p-3 text-left">Produto</th><th class="p-3 text-left">Transportadora</th><th class="p-3 text-center">Ações</th></tr></thead><tbody id="tabela-tickets"></tbody></table></div>
                <div id="tickets-pagination" class="mt-4 flex justify-center items-center gap-2"></div>
            </div>

            <div id="tab-content-relatorios" class="tab-content">
                <!-- Resumo Aprimorado -->
                <div id="relatorio-summary" class="hidden bg-gradient-to-r from-teal-50 to-blue-50 border-l-4 border-teal-500 p-6 rounded-r-lg mb-6 shadow-sm" role="alert">
                    <div class="flex justify-between items-center flex-wrap gap-4">
                        <div>
                            <p class="font-bold text-lg text-gray-800">📊 Resumo do Relatório</p>
                            <p id="relatorio-periodo-text" class="text-sm text-gray-600 mt-1"></p>
                        </div>
                        <div class="flex gap-x-8 gap-y-2 flex-wrap">
                            <div class="text-center">
                                <p class="text-xs text-gray-600 uppercase tracking-wide">Total de Tickets</p>
                                <p id="relatorio-total-tickets" class="text-2xl font-bold text-gray-800">0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 uppercase tracking-wide">Peso Líquido Total</p>
                                <p id="relatorio-total-liquido" class="text-2xl font-bold text-teal-600">0,00 kg</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Avançados -->
                <div id="relatorio-insights" class="hidden grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">💰 Peso Bruto Total</p>
                        <p id="relatorio-total-bruto" class="text-2xl font-bold text-gray-800 mt-2">0,00 kg</p>
                        <p id="relatorio-crescimento-bruto" class="text-xs text-green-600 mt-1"></p>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">⚖️ Peso Tara Total</p>
                        <p id="relatorio-total-tara" class="text-2xl font-bold text-gray-800 mt-2">0,00 kg</p>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">📈 Peso Líquido Médio</p>
                        <p id="relatorio-media-liquido" class="text-2xl font-bold text-gray-800 mt-2">0,00 kg</p>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">🏆 Top Transportadora</p>
                        <p id="relatorio-top-transportadora" class="text-base font-semibold text-gray-800 mt-2">Sem dados</p>
                    </div>
                </div>

                <!-- Alertas de Divergência -->
                <div id="relatorio-divergencias" class="hidden bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg mb-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800">⚠️ Divergências Detectadas</h3>
                            <div id="relatorio-divergencias-lista" class="mt-2 text-sm text-yellow-700"></div>
                            <button id="btn-export-divergencias" class="mt-3 text-xs font-semibold text-yellow-800 hover:text-yellow-900 underline">
                                📊 Exportar Lista de Divergências
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filtros Melhorados -->
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg text-gray-800">🔍 Filtros e Exportação</h3>
                        <div class="flex gap-2">
                            <button id="btn-salvar-filtro-favorito" class="text-sm px-3 py-1 bg-yellow-100 text-yellow-800 rounded-md hover:bg-yellow-200 font-semibold">
                                ⭐ Salvar Filtro
                            </button>
                            <button id="btn-carregar-filtro-favorito" class="text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-semibold">
                                📂 Carregar
                            </button>
                        </div>
                    </div>

                    <!-- Filtros Rápidos de Período -->
                    <div class="mb-4">
                        <label class="text-sm font-medium text-gray-700 block mb-2">⏰ Período Rápido</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="filtro-rapido-btn" data-periodo="hoje">Hoje</button>
                            <button class="filtro-rapido-btn" data-periodo="ontem">Ontem</button>
                            <button class="filtro-rapido-btn" data-periodo="semana">Última Semana</button>
                            <button class="filtro-rapido-btn" data-periodo="mes">Último Mês</button>
                            <button class="filtro-rapido-btn" data-periodo="trimestre">Último Trimestre</button>
                            <button class="filtro-rapido-btn" data-periodo="ano">Este Ano</button>
                        </div>
                    </div>

                    <!-- Filtros Existentes -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                        <div>
                            <label for="relatorio-titulo" class="text-sm font-medium text-gray-700">Título do Relatório</label>
                            <input type="text" id="relatorio-titulo" placeholder="Ex: Relatório de Brita" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-data-inicio" class="text-sm font-medium text-gray-700">Data Início</label>
                            <input type="date" id="filtro-data-inicio" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-data-fim" class="text-sm font-medium text-gray-700">Data Fim</label>
                            <input type="date" id="filtro-data-fim" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-obra" class="text-sm font-medium text-gray-700">Obra</label>
                            <select id="filtro-obra" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-produto" class="text-sm font-medium text-gray-700">Produto</label>
                            <select id="filtro-produto" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-fornecedor" class="text-sm font-medium text-gray-700">Fornecedor</label>
                            <select id="filtro-fornecedor" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="filtro-transportadora" class="text-sm font-medium text-gray-700">Transportadora</label>
                            <select id="filtro-transportadora" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                         <div>
                            <label for="filtro-motorista" class="text-sm font-medium text-gray-700">Motorista</label>
                            <input type="search" id="filtro-motorista" placeholder="Nome do motorista..." class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="filtro-certificado" class="text-sm font-medium text-gray-700">Certificado</label>
                            <input type="search" id="filtro-certificado" placeholder="Nº do certificado..." class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="lg:col-span-2">
                            <label for="filtro-pesquisa" class="text-sm font-medium text-gray-700">Pesquisa Geral</label>
                            <input type="search" id="filtro-pesquisa" placeholder="Placa, NF..." class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <!-- 🎯 FILTROS INTELIGENTES AVANÇADOS -->
                    <div class="mt-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-sm font-bold text-purple-800 flex items-center gap-2">
                                🎯 Filtros Inteligentes
                            </h4>
                            <button id="btn-toggle-filtros-avancados" class="text-xs text-purple-600 hover:text-purple-800 font-semibold">
                                ▼ Expandir
                            </button>
                        </div>
                        
                        <div id="filtros-avancados-content" class="space-y-4 hidden">
                            <!-- Faixa de Peso -->
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div>
                                    <label for="filtro-peso-min" class="text-sm font-medium text-gray-700">⚖️ Peso Mínimo (kg)</label>
                                    <input type="number" id="filtro-peso-min" placeholder="Ex: 5000" step="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="filtro-peso-max" class="text-sm font-medium text-gray-700">⚖️ Peso Máximo (kg)</label>
                                    <input type="number" id="filtro-peso-max" placeholder="Ex: 25000" step="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-700">⚡ Faixas Rápidas</label>
                                    <div class="flex gap-2 mt-1">
                                        <button class="filtro-peso-rapido text-xs px-3 py-2 bg-white border border-gray-300 rounded hover:bg-purple-100" data-min="0" data-max="10000">0-10t</button>
                                        <button class="filtro-peso-rapido text-xs px-3 py-2 bg-white border border-gray-300 rounded hover:bg-purple-100" data-min="10000" data-max="20000">10-20t</button>
                                        <button class="filtro-peso-rapido text-xs px-3 py-2 bg-white border border-gray-300 rounded hover:bg-purple-100" data-min="20000" data-max="50000">20-50t</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Horário do Dia -->
                            <div>
                                <label class="text-sm font-medium text-gray-700 block mb-2">🕐 Horário do Dia</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-3">
                                    <div>
                                        <label for="filtro-hora-inicio" class="text-xs text-gray-600">Hora Início</label>
                                        <input type="time" id="filtro-hora-inicio" class="mt-1 w-full p-2 border border-gray-300 rounded-md text-sm">
                                    </div>
                                    <div>
                                        <label for="filtro-hora-fim" class="text-xs text-gray-600">Hora Fim</label>
                                        <input type="time" id="filtro-hora-fim" class="mt-1 w-full p-2 border border-gray-300 rounded-md text-sm">
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button class="filtro-horario-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-inicio="06:00" data-fim="12:00">
                                        🌅 Manhã (06:00-12:00)
                                    </button>
                                    <button class="filtro-horario-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-inicio="12:00" data-fim="18:00">
                                        ☀️ Tarde (12:00-18:00)
                                    </button>
                                    <button class="filtro-horario-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-inicio="18:00" data-fim="23:59">
                                        🌙 Noite (18:00-23:59)
                                    </button>
                                    <button class="filtro-horario-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-inicio="00:00" data-fim="06:00">
                                        🌃 Madrugada (00:00-06:00)
                                    </button>
                                </div>
                            </div>

                            <!-- Status e Condições -->
                            <div>
                                <label class="text-sm font-medium text-gray-700 block mb-2">📊 Status e Condições</label>
                                <div class="flex flex-wrap gap-2">
                                    <button class="filtro-status-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-status="com-divergencia">
                                        ⚠️ Com Divergência
                                    </button>
                                    <button class="filtro-status-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-status="sem-divergencia">
                                        ✅ Sem Divergência
                                    </button>
                                    <button class="filtro-status-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-status="peso-zerado">
                                        🔴 Peso Zerado
                                    </button>
                                    <button class="filtro-status-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-status="com-certificado">
                                        📜 Com Certificado
                                    </button>
                                    <button class="filtro-status-btn text-xs px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-purple-100 transition-all" data-status="sem-certificado">
                                        ❌ Sem Certificado
                                    </button>
                                </div>
                            </div>

                            <!-- Busca Avançada com Operadores -->
                            <div class="bg-white p-4 rounded-lg border border-purple-200">
                                <label class="text-sm font-bold text-purple-800 block mb-2">🔍 Busca Avançada com Operadores</label>
                                <div class="space-y-3">
                                    <div class="flex gap-2">
                                        <select id="filtro-campo1" class="p-2 border border-gray-300 rounded text-xs flex-1">
                                            <option value="">Selecione campo...</option>
                                            <option value="placa">Placa</option>
                                            <option value="motorista">Motorista</option>
                                            <option value="produto">Produto</option>
                                            <option value="cliente">Cliente/Fornecedor</option>
                                            <option value="transportadora">Transportadora</option>
                                            <option value="nf">Nota Fiscal</option>
                                            <option value="certificado">Certificado</option>
                                        </select>
                                        <select id="filtro-operador1" class="p-2 border border-gray-300 rounded text-xs w-32">
                                            <option value="contem">Contém</option>
                                            <option value="igual">Igual a</option>
                                            <option value="diferente">Diferente de</option>
                                            <option value="comeca">Começa com</option>
                                            <option value="termina">Termina com</option>
                                        </select>
                                        <input type="text" id="filtro-valor1" placeholder="Valor..." class="p-2 border border-gray-300 rounded text-xs flex-1">
                                    </div>
                                    
                                    <div class="flex items-center gap-2">
                                        <select id="filtro-logico" class="p-2 border border-gray-300 rounded text-xs font-bold bg-yellow-50">
                                            <option value="and">E (AND)</option>
                                            <option value="or">OU (OR)</option>
                                        </select>
                                        <span class="text-xs text-gray-500">Combinar com segunda condição</span>
                                    </div>
                                    
                                    <div class="flex gap-2">
                                        <select id="filtro-campo2" class="p-2 border border-gray-300 rounded text-xs flex-1">
                                            <option value="">Selecione campo...</option>
                                            <option value="placa">Placa</option>
                                            <option value="motorista">Motorista</option>
                                            <option value="produto">Produto</option>
                                            <option value="cliente">Cliente/Fornecedor</option>
                                            <option value="transportadora">Transportadora</option>
                                            <option value="nf">Nota Fiscal</option>
                                            <option value="certificado">Certificado</option>
                                        </select>
                                        <select id="filtro-operador2" class="p-2 border border-gray-300 rounded text-xs w-32">
                                            <option value="contem">Contém</option>
                                            <option value="igual">Igual a</option>
                                            <option value="diferente">Diferente de</option>
                                            <option value="comeca">Começa com</option>
                                            <option value="termina">Termina com</option>
                                        </select>
                                        <input type="text" id="filtro-valor2" placeholder="Valor..." class="p-2 border border-gray-300 rounded text-xs flex-1">
                                    </div>
                                </div>
                            </div>

                            <!-- Botão de Limpar Filtros Avançados -->
                            <div class="flex justify-end gap-2">
                                <span id="filtros-ativos-badge" class="text-xs px-3 py-2 bg-purple-100 text-purple-700 rounded-lg font-semibold hidden"></span>
                                <button id="btn-limpar-filtros-avancados" class="text-sm px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-semibold transition-all">
                                    🗑️ Limpar Filtros Avançados
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Exportação Melhorados -->
                    <div class="flex items-center justify-between flex-wrap gap-3 mt-6 pt-4 border-t border-gray-200">
                        <div class="relatorio-btn-group">
                            <button id="btn-import-excel" class="admin-only inline-flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                Importar
                            </button>
                            <input type="file" id="import-excel-input" class="hidden" accept=".xlsx, .xls, .csv">
                        </div>

                        <div class="relatorio-btn-group">
                            <!-- NOVO: Botão de Exportação Personalizada -->
                            <button id="btn-export-custom" class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:from-purple-700 hover:to-indigo-700 transition-all shadow-md">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                                🎨 Exportação Personalizada
                            </button>
                        </div>

                        <div class="relatorio-btn-group">
                            <!-- PDF com Dropdown -->
                            <div class="export-dropdown">
                                <button id="btn-export-pdf-toggle" class="inline-flex items-center gap-2 bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                    PDF ▼
                                </button>
                                <div id="pdf-dropdown-menu" class="export-dropdown-content">
                                    <button id="btn-export-pdf-simples">📄 PDF Simples</button>
                                    <button id="btn-export-pdf-completo">📊 PDF com Gráficos</button>
                                    <button id="btn-export-pdf-resumo">📋 PDF Resumo Executivo</button>
                                </div>
                            </div>

                            <!-- Excel com Dropdown -->
                            <div class="export-dropdown">
                                <button id="btn-export-excel-toggle" class="inline-flex items-center gap-2 bg-green-700 text-white font-semibold py-2 px-4 rounded-md hover:bg-green-800 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    Excel ▼
                                </button>
                                <div id="excel-dropdown-menu" class="export-dropdown-content">
                                    <button id="btn-export-excel-simples">📗 Excel Padrão</button>
                                    <button id="btn-export-excel-multiabas">📊 Excel com Múltiplas Abas</button>
                                    <button id="btn-export-excel-agregado">🧮 Excel Controle Agregado</button>
                                    <button id="btn-export-csv">📄 CSV (Compatível ERP)</button>
                                </div>
                            </div>
                            
                            <!-- Enviar por Email -->
                            <button id="btn-enviar-email" class="inline-flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                📧 Enviar por Email
                            </button>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-left">Nº</th><th class="p-3 text-left">Data</th><th class="p-3 text-left">Placa</th>
                                <th class="p-3 text-left">Nota Fiscal</th><th class="p-3 text-left">Cliente</th><th class="p-3 text-left">Transportadora</th><th class="p-3 text-left">Obra</th><th class="p-3 text-left">Produto</th><th class="p-3 text-left">Certificado</th>
                                <th class="p-3 text-right">P. Líquido</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-relatorios"></tbody>
                    </table>
                </div>
                 <div id="relatorios-pagination" class="mt-4 flex justify-center items-center gap-2"></div>

                <div id="relatorio-agrupamentos" class="hidden mt-8 space-y-4">
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800">Totais por Transportadora</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm mt-2 border border-gray-200 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 text-gray-700">
                                    <tr>
                                        <th class="p-3 text-left">Transportadora</th>
                                        <th class="p-3 text-right">Viagens</th>
                                        <th class="p-3 text-right">Peso Líquido</th>
                                        <th class="p-3 text-right">Peso Bruto</th>
                                    </tr>
                                </thead>
                                <tbody id="relatorio-transportadora-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="tab-content-dashboard" class="tab-content">
                      <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                            <label for="db-filtro-fornecedor" class="text-sm font-medium text-gray-700">🏢 Filtrar por Fornecedor</label>
                            <select id="db-filtro-fornecedor" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                         <div>
                            <label for="db-filtro-produto" class="text-sm font-medium text-gray-700">📦 Filtrar por Produto</label>
                            <select id="db-filtro-produto" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="db-filtro-transportadora" class="text-sm font-medium text-gray-700">🚛 Filtrar por Transportadora</label>
                            <select id="db-filtro-transportadora" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                             <button id="btn-db-limpar-filtros" class="w-full bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300">🔄 Limpar Filtros</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="glass-stat-card animate-fade-in">
                        <h4 class="text-sm font-medium text-gray-600">📊 Pesagens (Hoje)</h4>
                        <p id="db-stat-pesagens-hoje" class="text-3xl font-bold text-gray-800 mt-1">0</p>
                    </div>
                    <div class="glass-stat-card animate-fade-in" style="animation-delay: 0.1s;">
                        <h4 class="text-sm font-medium text-gray-600">⚖️ Peso Líquido (Hoje)</h4>
                        <p id="db-stat-peso-hoje" class="text-3xl font-bold text-gray-800 mt-1">0,00 kg</p>
                    </div>
                    <div class="glass-stat-card animate-fade-in" style="animation-delay: 0.2s;">
                        <h4 class="text-sm font-medium text-gray-600">🚛 Veículos no Pátio</h4>
                        <p id="db-stat-veiculos-patio" class="text-3xl font-bold text-gray-800 mt-1">0</p>
                    </div>
                    <div class="glass-stat-card animate-fade-in" style="animation-delay: 0.3s;">
                        <h4 class="text-sm font-medium text-gray-600">📈 Peso Médio / Ticket</h4>
                        <p id="db-stat-ticket-medio" class="text-3xl font-bold text-gray-800 mt-1">0,00 kg</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="glass-card animate-slide-in-up">
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">📈 Pesagens por Dia (Últimos 7 dias)</h3>
                            <div class="h-64 relative">
                                <canvas id="chart-pesagens-dia"></canvas>
                            </div>
                        </div>
                        <div class="glass-card animate-slide-in-up" style="animation-delay: 0.1s;">
                            <h3 class="text-lg font-semibold mb-4 text-gray-800">🕒 Últimas 5 Pesagens</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="p-2 text-left font-medium">Placa</th>
                                            <th class="p-2 text-left font-medium">Produto</th>
                                            <th class="p-2 text-right font-medium">P. Líquido</th>
                                            <th class="p-2 text-center font-medium">Ação</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dashboard-ultimas-pesagens">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="glass-card animate-slide-in-up" style="animation-delay: 0.2s;">
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">📊 Peso por Produto</h3>
                            <div class="h-64 relative">
                                <canvas id="chart-peso-produto"></canvas>
                            </div>
                        </div>
                        <div class="glass-card animate-slide-in-up" style="animation-delay: 0.3s;">
                            <h3 class="text-lg font-semibold mb-4 text-gray-800">🏆 Top 5 Produtos</h3>
                            <div id="dashboard-top-produtos" class="space-y-3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-content-cadastros" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">🏢 Fornecedores</h3>
                            <form id="form-fornecedor" class="flex gap-3 mb-4"><input type="text" id="nome-fornecedor" placeholder="Novo fornecedor" class="flex-grow p-2 border border-gray-300 rounded-md" required><button type="submit" class="btn-primary text-white font-semibold py-2 px-4 rounded-md">➕ Adicionar</button></form>
                            <div class="overflow-auto max-h-48 border border-gray-200 rounded-md"><table class="min-w-full"><tbody id="tabela-fornecedores"></tbody></table></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">🚛 Transportadoras</h3>
                            <form id="form-transportadora" class="flex gap-3 mb-4"><input type="text" id="nome-transportadora" placeholder="Nova transportadora" class="flex-grow p-2 border border-gray-300 rounded-md" required><button type="submit" class="btn-primary text-white font-semibold py-2 px-4 rounded-md">➕ Adicionar</button></form>
                            <div class="overflow-auto max-h-48 border border-gray-200 rounded-md"><table class="min-w-full"><tbody id="tabela-transportadoras"></tbody></table></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">🏛️ Razões Sociais</h3>
                            <form id="form-razao-social" class="flex gap-3 mb-4"><input type="text" id="nome-razao-social" placeholder="Nova razão social" class="flex-grow p-2 border border-gray-300 rounded-md" required><button type="submit" class="btn-primary text-white font-semibold py-2 px-4 rounded-md">➕ Adicionar</button></form>
                            <div class="overflow-auto max-h-48 border border-gray-200 rounded-md"><table class="min-w-full"><tbody id="tabela-razoes-sociais"></tbody></table></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">🏗️ Obras</h3>
                            <form id="form-obra" class="flex gap-3 mb-4"><input type="text" id="nome-obra" placeholder="Nova obra" class="flex-grow p-2 border border-gray-300 rounded-md" required><button type="submit" class="btn-primary text-white font-semibold py-2 px-4 rounded-md">➕ Adicionar</button></form>
                            <div class="overflow-auto max-h-48 border border-gray-200 rounded-md"><table class="min-w-full"><tbody id="tabela-obras"></tbody></table></div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">📦 Produtos</h3>
                        <form id="form-produto" class="flex flex-col sm:flex-row gap-3 mb-4">
                            <input type="text" id="nome-produto" placeholder="Nome do produto" class="flex-grow p-2 border border-gray-300 rounded-md" required>
                            <input type="text" id="certificado-produto" placeholder="Certificado (opcional)" class="flex-grow p-2 border border-gray-300 rounded-md">
                            <button type="submit" class="btn-primary text-white font-semibold py-2 px-4 rounded-md">➕ Adicionar</button>
                        </form>
                        <div class="overflow-auto max-h-96 border border-gray-200 rounded-md">
                            <table class="min-w-full text-sm">
                                <thead class="bg-gray-50 sticky top-0"><tr><th class="p-3 text-left font-medium">Produto</th><th class="p-3 text-left font-medium">Certificado</th><th class="p-3 text-right font-medium">Ação</th></tr></thead>
                                <tbody id="tabela-produtos"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nova Aba: Gerenciamento de Usuários (Só para Dono) -->
            <div id="tab-content-usuarios" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-6">👥 Gerenciamento de Usuários</h2>
                
                <!-- Configuração do Dono -->
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-500 p-6 rounded-r-lg mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">👑 Configuração do Proprietário</h3>
                    <p class="text-sm text-gray-600 mb-4">Defina o email do proprietário do sistema (acesso total e irrevogável)</p>
                    
                    <div class="flex gap-3">
                        <input type="email" id="input-email-dono" placeholder="dono@empresa.com" 
                               class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500">
                        <button id="btn-set-dono" class="bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 font-semibold transition-all">
                            💾 Definir Dono
                        </button>
                    </div>
                    
                    <div id="current-dono-display" class="mt-4 hidden">
                        <p class="text-sm font-semibold text-gray-700">Email do Dono Atual:</p>
                        <p id="current-dono-email" class="text-lg font-bold text-yellow-700"></p>
                    </div>
                </div>
                
                <!-- Lista de Usuários -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">📋 Usuários Registrados</h3>
                        <button id="btn-refresh-users" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 font-semibold transition-all">
                            🔄 Atualizar
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3 text-left">👤 Nome</th>
                                    <th class="p-3 text-left">📧 Email</th>
                                    <th class="p-3 text-left">🎭 Nível de Acesso</th>
                                    <th class="p-3 text-left">📅 Criado Em</th>
                                    <th class="p-3 text-left">✅ Status</th>
                                    <th class="p-3 text-left">📝 Programação</th>
                                    <th class="p-3 text-center">⚙️ Ações</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Legenda de Permissões -->
                <div class="mt-6 bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">📖 Níveis de Acesso</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="role-card">
                            <div class="user-badge badge-dono mb-3">👑 Dono</div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>✅ Acesso total ao sistema</li>
                                <li>✅ Gerenciar usuários</li>
                                <li>✅ Promover/rebaixar usuários</li>
                                <li>✅ Ver histórico de acessos</li>
                                <li>✅ Todas as configurações</li>
                            </ul>
                        </div>
                        
                        <div class="role-card">
                            <div class="user-badge badge-operador mb-3">⚖️ Operador</div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>✅ Entrada e Saída de veículos</li>
                                <li>✅ Editar tickets</li>
                                <li>✅ Visualizar relatórios</li>
                                <li>✅ Cadastros (produtos, obras)</li>
                                <li>❌ Gerenciar usuários</li>
                            </ul>
                        </div>
                        
                        <div class="role-card">
                            <div class="user-badge badge-visualizador mb-3">👁️ Visualizador</div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>✅ Visualizar Tickets</li>
                                <li>✅ Relatórios e Dashboard</li>
                                <li>❌ Entrada e Saída</li>
                                <li>❌ Editar tickets</li>
                                <li>❌ Gerenciar usuários</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nova Aba: Atividades/Logs (Só para Dono) -->
            <div id="tab-content-atividades" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-6">👁️ Histórico de Atividades</h2>
                
                <!-- Filtros -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">🔍 Filtros</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="filtro-log-usuario" class="text-sm font-medium text-gray-700">👤 Usuário</label>
                            <select id="filtro-log-usuario" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                <option value="">Todos os usuários</option>
                            </select>
                        </div>
                        <div>
                            <label for="filtro-log-acao" class="text-sm font-medium text-gray-700">📝 Tipo de Ação</label>
                            <select id="filtro-log-acao" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                <option value="">Todas as ações</option>
                                <optgroup label="🔐 Acesso">
                                    <option value="login">🔓 Login</option>
                                    <option value="logout">🔒 Logout</option>
                                </optgroup>
                                <optgroup label="🎫 Tickets">
                                    <option value="criou_entrada">📥 Criou Entrada</option>
                                    <option value="criou_saida">📤 Criou Saída</option>
                                    <option value="editou_ticket">✏️ Editou Ticket</option>
                                    <option value="deletou_ticket">🗑️ Deletou Ticket</option>
                                </optgroup>
                                <optgroup label="📊 Relatórios">
                                    <option value="exportou_pdf">📕 Exportou PDF</option>
                                    <option value="exportou_excel">📗 Exportou Excel</option>
                                    <option value="exportou_csv">📄 Exportou CSV</option>
                                    <option value="exportou_json">📋 Exportou JSON</option>
                                    <option value="importou_dados">📥 Importou Dados</option>
                                </optgroup>
                                <optgroup label="📋 Cadastros">
                                    <option value="cadastrou_fornecedor">🏢 Cadastrou Fornecedor</option>
                                    <option value="cadastrou_transportadora">🚛 Cadastrou Transportadora</option>
                                    <option value="cadastrou_produto">📦 Cadastrou Produto</option>
                                    <option value="cadastrou_obra">🏗️ Cadastrou Obra</option>
                                    <option value="deletou_cadastro">🗑️ Deletou Cadastro</option>
                                </optgroup>
                                <optgroup label="📝 Programação">
                                    <option value="criou_programacao">📝 Criou Programação</option>
                                    <option value="editou_programacao">✏️ Editou Programação</option>
                                    <option value="removeu_programacao">🗑️ Removeu Programação</option>
                                    <option value="alterou_programacao_permissao">🛡️ Alterou Permissão</option>
                                </optgroup>
                                <optgroup label="⚙️ Sistema">
                                    <option value="mudou_permissao">🎭 Mudou Permissão</option>
                                    <option value="alterou_config">⚙️ Alterou Configurações</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label for="filtro-log-periodo" class="text-sm font-medium text-gray-700">📅 Período</label>
                            <select id="filtro-log-periodo" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                <option value="24h">Últimas 24 horas</option>
                                <option value="7d">Últimos 7 dias</option>
                                <option value="30d">Últimos 30 dias</option>
                                <option value="todos">Todos</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-limpar-filtros-logs" class="w-full bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300">
                                🔄 Limpar Filtros
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas Rápidas -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-5 border-l-4 border-green-500">
                        <h4 class="text-sm font-medium text-gray-600">Total de Ações</h4>
                        <p id="stat-total-acoes" class="text-3xl font-bold text-green-700 mt-1">0</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-5 border-l-4 border-blue-500">
                        <h4 class="text-sm font-medium text-gray-600">Tickets Criados</h4>
                        <p id="stat-tickets-criados" class="text-3xl font-bold text-blue-700 mt-1">0</p>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-lg p-5 border-l-4 border-yellow-500">
                        <h4 class="text-sm font-medium text-gray-600">Edições</h4>
                        <p id="stat-edicoes" class="text-3xl font-bold text-yellow-700 mt-1">0</p>
                    </div>
                    <div class="bg-gradient-to-r from-red-50 to-red-100 rounded-lg p-5 border-l-4 border-red-500">
                        <h4 class="text-sm font-medium text-gray-600">Exclusões</h4>
                        <p id="stat-exclusoes" class="text-3xl font-bold text-red-700 mt-1">0</p>
                    </div>
                </div>

                <!-- Timeline de Atividades -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">📜 Timeline de Atividades</h3>
                        <div class="flex flex-wrap gap-2 items-center">
                            <select id="timeline-limit" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="10">Mostrar 10</option>
                                <option value="25" selected>Mostrar 25</option>
                                <option value="50">Mostrar 50</option>
                                <option value="100">Mostrar 100</option>
                                <option value="all">Mostrar Todos</option>
                            </select>
                            <button id="btn-exportar-logs" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 font-semibold transition-all text-sm">
                                📥 Exportar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Resumo compacto -->
                    <div id="timeline-summary" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-4 flex flex-wrap gap-4 justify-around text-center">
                        <div>
                            <p class="text-xs text-gray-600 uppercase font-semibold">Total</p>
                            <p id="timeline-total" class="text-2xl font-bold text-blue-600">0</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 uppercase font-semibold">Hoje</p>
                            <p id="timeline-hoje" class="text-2xl font-bold text-green-600">0</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600 uppercase font-semibold">Esta Semana</p>
                            <p id="timeline-semana" class="text-2xl font-bold text-teal-600">0</p>
                        </div>
                    </div>
                    
                    <div id="timeline-atividades" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                        <div class="text-center text-gray-500 py-8">
                            <p class="text-lg">🔍 Nenhuma atividade encontrada</p>
                            <p class="text-sm mt-2">As atividades dos usuários aparecerão aqui</p>
                        </div>
                    </div>
                    
                    <!-- Paginação -->
                    <div id="timeline-pagination" class="hidden mt-4 flex justify-center items-center gap-2">
                        <button id="timeline-prev" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            ← Anterior
                        </button>
                        <span id="timeline-page-info" class="text-sm text-gray-600 px-4">Página 1</span>
                        <button id="timeline-next" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            Próxima →
                        </button>
                    </div>
                </div>

                <!-- Ranking de Usuários -->
                <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Ranking de Produtividade</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3 text-left">🏅 Pos.</th>
                                    <th class="p-3 text-left">👤 Usuário</th>
                                    <th class="p-3 text-center">📥 Entradas</th>
                                    <th class="p-3 text-center">📤 Saídas</th>
                                    <th class="p-3 text-center">✏️ Edições</th>
                                    <th class="p-3 text-center">🗑️ Exclusões</th>
                                    <th class="p-3 text-center">🔓 Logins</th>
                                    <th class="p-3 text-left">🕐 Último Acesso</th>
                                </tr>
                            </thead>
                            <tbody id="ranking-usuarios-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer id="app-footer" class="text-center mt-8 text-sm text-gray-500"></footer>
    
    <!-- Modal para Alterar Nível de Acesso -->
    <div id="modal-change-role" class="modal">
        <div class="modal-content max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">🎭 Alterar Nível de Acesso</h3>
                <button class="modal-close text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600">Usuário:</p>
                    <p id="modal-user-name" class="text-lg font-bold text-gray-800"></p>
                    <p id="modal-user-email" class="text-sm text-gray-500"></p>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-gray-700 block mb-2">Selecione o novo nível:</label>
                    <select id="select-new-role" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="visualizador">👁️ Visualizador</option>
                        <option value="operador">⚖️ Operador</option>
                    </select>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button id="btn-cancel-change-role" class="flex-1 bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">
                        ❌ Cancelar
                    </button>
                    <button id="btn-confirm-change-role" class="flex-1 btn-primary text-white font-semibold py-2 px-4 rounded-lg">
                        ✅ Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Solicitação de Promoção -->
    <div id="modal-promotion" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 class="text-lg font-bold text-gray-800 text-center mb-4">🔓 Solicitar Promoção para Operador</h3>
            <p class="text-sm text-gray-600 mb-4 text-center">Digite a senha fornecida pelo proprietário para ter acesso às funcionalidades de pesagem.</p>
            
            <form id="form-promotion">
                <label for="promotion-password" class="block text-sm font-medium text-gray-700 mb-1">🔑 Senha de Promoção</label>
                <input type="password" id="promotion-password" class="mt-1 w-full p-3 border border-gray-300 rounded-md" required placeholder="Digite a senha secreta">
                <p id="promotion-error" class="text-red-500 text-sm mt-2 h-4"></p>
                
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" id="btn-cancel-promotion" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300">❌ Cancelar</button>
                    <button type="submit" id="btn-confirm-promotion" class="btn-primary text-white font-semibold py-2 px-6 rounded-md">✅ Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Botão flutuante para solicitar promoção (visível apenas para visualizadores) -->
    <button id="btn-request-promo" class="hidden fixed bottom-6 right-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all z-50">
        🔓 Solicitar Promoção
    </button>

    <!-- Modal de Exportação Personalizada -->
    <div id="modal-export-custom" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">📤 Exportação Personalizada</h3>
                <button id="btn-close-export-custom" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
            </div>
            
            <form id="form-export-custom" class="space-y-6">
                <!-- Formato de Exportação -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-bold text-gray-700 mb-3">📄 Formato de Exportação</label>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="export-format" value="pdf" checked class="peer hidden">
                            <div class="peer-checked:border-teal-600 peer-checked:bg-teal-50 border-2 border-gray-300 rounded-lg p-3 text-center hover:border-teal-400 transition-all">
                                <div class="text-2xl mb-1">📕</div>
                                <div class="text-xs font-semibold">PDF</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="export-format" value="excel" class="peer hidden">
                            <div class="peer-checked:border-green-600 peer-checked:bg-green-50 border-2 border-gray-300 rounded-lg p-3 text-center hover:border-green-400 transition-all">
                                <div class="text-2xl mb-1">📗</div>
                                <div class="text-xs font-semibold">Excel</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="export-format" value="csv" class="peer hidden">
                            <div class="peer-checked:border-blue-600 peer-checked:bg-blue-50 border-2 border-gray-300 rounded-lg p-3 text-center hover:border-blue-400 transition-all">
                                <div class="text-2xl mb-1">📄</div>
                                <div class="text-xs font-semibold">CSV</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="export-format" value="json" class="peer hidden">
                            <div class="peer-checked:border-purple-600 peer-checked:bg-purple-50 border-2 border-gray-300 rounded-lg p-3 text-center hover:border-purple-400 transition-all">
                                <div class="text-2xl mb-1">📋</div>
                                <div class="text-xs font-semibold">JSON</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Colunas para Exportar -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-3">
                        <label class="block text-sm font-bold text-gray-700">📋 Colunas para Exportar</label>
                        <div class="text-xs space-x-2">
                            <button type="button" id="btn-select-all-cols" class="text-teal-600 hover:underline font-semibold">✓ Todas</button>
                            <button type="button" id="btn-deselect-all-cols" class="text-gray-600 hover:underline font-semibold">✗ Nenhuma</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-48 overflow-y-auto">
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-num" checked class="export-col-checkbox"> Nº Ticket
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-data" checked class="export-col-checkbox"> Data
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-placa" checked class="export-col-checkbox"> Placa
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-motorista" checked class="export-col-checkbox"> Motorista
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-produto" checked class="export-col-checkbox"> Produto
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-cliente" checked class="export-col-checkbox"> Cliente
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-transportadora" checked class="export-col-checkbox"> Transportadora
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-razao-social" class="export-col-checkbox"> Razão Social
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-obra" class="export-col-checkbox"> Obra
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-peso-bruto" checked class="export-col-checkbox"> Peso Bruto
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-tara" checked class="export-col-checkbox"> Tara
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-peso-liquido" checked class="export-col-checkbox"> Peso Líquido
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-nf" checked class="export-col-checkbox"> Nota Fiscal
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-peso-nf-liquido" class="export-col-checkbox"> 🧾 Peso NF Líquido
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-diferenca-peso" class="export-col-checkbox"> 📊 Diferença (kg)
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-percentual-diferenca" class="export-col-checkbox"> 📈 Diferença (%)
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-certificado" class="export-col-checkbox"> Certificado
                        </label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white p-2 rounded">
                            <input type="checkbox" name="col-observacoes" class="export-col-checkbox"> Observações
                        </label>
                    </div>
                </div>

                <!-- Opções Avançadas (PDF) -->
                <div id="pdf-options" class="bg-gradient-to-r from-red-50 to-orange-50 p-4 rounded-lg border-l-4 border-red-500">
                    <label class="block text-sm font-bold text-gray-700 mb-3">🔐 Opções de PDF</label>
                    
                    <div class="space-y-3">
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="pdf-watermark" id="pdf-watermark"> Adicionar Marca d'Água
                        </label>
                        
                        <div id="watermark-text-container" class="hidden ml-6">
                            <input type="text" id="watermark-text" placeholder="Texto da marca d'água..." class="w-full p-2 text-sm border border-gray-300 rounded-md" value="CONFIDENCIAL">
                        </div>
                        
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="pdf-landscape"> Orientação Paisagem
                        </label>
                        
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="pdf-compress"> Comprimir PDF (menor tamanho)
                        </label>
                    </div>
                </div>

                <!-- Opções Avançadas (Excel) -->
                <div id="excel-options" class="hidden bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border-l-4 border-green-500">
                    <label class="block text-sm font-bold text-gray-700 mb-3">📊 Opções de Excel</label>
                    
                    <div class="space-y-3">
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="excel-formatting" checked> Formatação Condicional (cores por peso)
                        </label>
                        
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="excel-formulas" checked> Adicionar Fórmulas de Soma
                        </label>
                        
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="excel-freeze" checked> Congelar Primeira Linha
                        </label>
                        
                        <label class="flex items-center gap-2 text-sm cursor-pointer">
                            <input type="checkbox" name="excel-autofilter" checked> Habilitar Auto-Filtro
                        </label>
                    </div>
                </div>

                <!-- Ordenação -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-bold text-gray-700 mb-3">🔢 Ordenar Por</label>
                    <div class="grid grid-cols-2 gap-3">
                        <select id="sort-by" class="p-2 border border-gray-300 rounded-md text-sm">
                            <option value="data-desc">Data (mais recente)</option>
                            <option value="data-asc">Data (mais antigo)</option>
                            <option value="num-desc">Nº Ticket (maior)</option>
                            <option value="num-asc">Nº Ticket (menor)</option>
                            <option value="peso-desc">Peso Líquido (maior)</option>
                            <option value="peso-asc">Peso Líquido (menor)</option>
                            <option value="placa">Placa (A-Z)</option>
                            <option value="produto">Produto (A-Z)</option>
                        </select>
                        
                        <input type="text" id="export-filename" placeholder="Nome do arquivo..." class="p-2 border border-gray-300 rounded-md text-sm" value="relatorio_balanca">
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                    <button type="button" id="btn-cancel-export-custom" class="px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-all">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-2 btn-primary text-white font-semibold rounded-lg transition-all">
                        🚀 Exportar Agora
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Enviar Relatório por Email - VERSÃO PROFISSIONAL -->
    <div id="modal-enviar-email" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full overflow-y-auto relative" style="max-width: 750px; max-height: 90vh;">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px 8px 0 0;">
                <h2 style="margin: 0; color: white; display: flex; align-items: center; gap: 10px; font-size: 22px;">
                    <span style="font-size: 28px;">📧</span>
                    Sistema Profissional de Envio de Relatórios
                </h2>
                <button id="btn-close-enviar-email" style="position: absolute; top: 15px; right: 20px; color: white; font-size: 30px; background: none; border: none; cursor: pointer;">&times;</button>
            </div>
            
            <div style="padding: 25px;">
                
                <!-- ABAS DE NAVEGAÇÃO -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button class="email-tab active" data-tab="enviar" onclick="balanca.trocarAbaEmail('enviar')" 
                        style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 600; border-bottom: 3px solid #667eea; color: #667eea;">
                        📤 Enviar Email
                    </button>
                    <button class="email-tab" data-tab="historico" onclick="balanca.trocarAbaEmail('historico')" 
                        style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666;">
                        📜 Histórico
                    </button>
                    <button class="email-tab" data-tab="modelos" onclick="balanca.trocarAbaEmail('modelos')" 
                        style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666;">
                        📝 Modelos
                    </button>
                    <button class="email-tab" data-tab="favoritos" onclick="balanca.trocarAbaEmail('favoritos')" 
                        style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666;">
                        ⭐ Favoritos
                    </button>
                </div>

                <!-- ABA ENVIAR EMAIL -->
                <div id="email-tab-enviar" class="email-tab-content">
                    
                    <!-- DESTINATÁRIOS COM CHIPS -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            Para: <span style="color: #dc3545;">*</span>
                        </label>
                        <div id="email-chips-container" style="display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; min-height: 50px; background: #f9f9f9;">
                            <div style="color: #999; font-size: 14px;">Nenhum destinatário adicionado</div>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <input type="email" id="email-destinatario-input" placeholder="Digite o email e pressione Enter ou clique em +"
                                style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                            <button type="button" id="btn-adicionar-destinatario" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ➕ Adicionar
                            </button>
                        </div>
                        <button type="button" id="btn-carregar-favoritos" style="margin-top: 8px; padding: 8px 15px; background: #ffc107; color: #333; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            ⭐ Carregar Favoritos
                        </button>
                    </div>

                    <!-- ASSUNTO -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            Assunto: <span style="color: #dc3545;">*</span>
                        </label>
                        <input type="text" id="email-assunto" placeholder="Relatório de Pesagens - Janeiro 2024"
                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>

                    <!-- MENSAGEM COM MODELOS -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            Mensagem:
                        </label>
                        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                            <select id="email-modelo-select" style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                <option value="">Selecione um modelo de mensagem...</option>
                                <option value="formal">📋 Formal - Envio de Relatório</option>
                                <option value="simples">💼 Simples - Dados Anexos</option>
                                <option value="detalhado">📊 Detalhado - Com Resumo</option>
                                <option value="urgente">⚡ Urgente - Solicitação Imediata</option>
                                <option value="custom">✏️ Mensagem Personalizada</option>
                            </select>
                        </div>
                        <textarea id="email-mensagem" rows="6" placeholder="Digite sua mensagem aqui..."
                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; resize: vertical;"></textarea>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                            <button type="button" id="btn-inserir-resumo" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                📊 Resumo
                            </button>
                            <button type="button" id="btn-inserir-periodo" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                📅 Período
                            </button>
                            <button type="button" id="btn-inserir-fornecedores" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                📦 Fornecedores
                            </button>
                            <button type="button" id="btn-inserir-materiais" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                🏗️ Materiais
                            </button>
                            <button type="button" id="btn-copiar-dados" style="padding: 6px 12px; background: #17a2b8; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                📋 Copiar Dados
                            </button>
                        </div>
                    </div>

                    <!-- FORMATO DO ARQUIVO -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                            Formato do Anexo:
                        </label>
                        <div style="display: flex; gap: 15px;">
                            <label class="formato-radio" style="display: flex; align-items: center; padding: 15px 25px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; flex: 1; transition: all 0.3s;">
                                <input type="radio" name="email-formato" value="pdf" checked style="margin-right: 10px; width: 20px; height: 20px;">
                                <div>
                                    <div style="font-size: 24px; margin-bottom: 5px;">📄</div>
                                    <strong>PDF</strong>
                                    <div style="font-size: 12px; color: #666;">Documento profissional</div>
                                </div>
                            </label>
                            <label class="formato-radio" style="display: flex; align-items: center; padding: 15px 25px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; flex: 1; transition: all 0.3s;">
                                <input type="radio" name="email-formato" value="excel" style="margin-right: 10px; width: 20px; height: 20px;">
                                <div>
                                    <div style="font-size: 24px; margin-bottom: 5px;">📊</div>
                                    <strong>Excel</strong>
                                    <div style="font-size: 12px; color: #666;">Planilha editável</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- PREVIEW DO RELATÓRIO -->
                    <div style="background: linear-gradient(135deg, #667eea15, #764ba215); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; color: #667eea; font-size: 16px;">📊 Preview do Relatório</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 11px; color: #666; margin-bottom: 5px;">TOTAL DE PESAGENS</div>
                                <div id="preview-total-pesagens" style="font-size: 28px; font-weight: bold; color: #667eea;">0</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 11px; color: #666; margin-bottom: 5px;">PESO TOTAL</div>
                                <div id="preview-peso-total" style="font-size: 28px; font-weight: bold; color: #28a745;">0 kg</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 11px; color: #666; margin-bottom: 5px;">PERÍODO</div>
                                <div id="preview-periodo" style="font-size: 12px; font-weight: bold; color: #764ba2; margin-top: 5px;">Hoje</div>
                            </div>
                        </div>
                        <button type="button" onclick="balanca.visualizarAnexo()" style="width: 100%; margin-top: 15px; padding: 12px; background: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
                            👁️ Visualizar Anexo Antes de Enviar
                        </button>
                    </div>

                    <!-- OPÇÕES AVANÇADAS -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="email-salvar-favoritos" style="margin-right: 10px; width: 18px; height: 18px;">
                            <span style="font-weight: 600;">⭐ Salvar destinatários nos favoritos</span>
                        </label>
                    </div>

                    <!-- INFORMAÇÃO -->
                    <div style="background: #d1ecf1; border-left: 4px solid #0c5460; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: flex-start; gap: 10px;">
                            <span style="font-size: 24px;">ℹ️</span>
                            <div style="font-size: 13px; color: #0c5460; line-height: 1.6;">
                                <strong>Como funciona (100% Gratuito):</strong><br>
                                1️⃣ O relatório será baixado automaticamente no formato escolhido<br>
                                2️⃣ Seu cliente de email padrão abrirá com os dados preenchidos<br>
                                3️⃣ Anexe o arquivo baixado manualmente e clique em enviar<br>
                                <br>
                                💡 <strong>Dica:</strong> Em dispositivos Android/Chrome, você pode compartilhar direto!
                            </div>
                        </div>
                    </div>

                    <!-- BOTÕES DE AÇÃO -->
                    <div style="display: flex; gap: 15px;">
                        <button type="button" id="btn-cancel-enviar-email" 
                            style="flex: 1; padding: 15px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600;">
                            ❌ Cancelar
                        </button>
                        <button type="button" id="btn-preparar-email" 
                            style="flex: 2; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                            📧 Preparar Email e Baixar Anexo
                        </button>
                    </div>
                </div>

                <!-- ABA HISTÓRICO -->
                <div id="email-tab-historico" class="email-tab-content" style="display: none;">
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: #333;">📜 Histórico de Envios</h3>
                        <button type="button" id="btn-limpar-historico" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            🗑️ Limpar Histórico
                        </button>
                    </div>
                    <div id="email-historico-lista" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 40px; color: #999;">📭 Nenhum email enviado ainda</div>
                    </div>
                </div>

                <!-- ABA MODELOS -->
                <div id="email-tab-modelos" class="email-tab-content" style="display: none;">
                    <h3 style="margin: 0 0 20px 0; color: #333;">📝 Modelos de Mensagem</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div onclick="balanca.aplicarModeloPersonalizado('formal')" style="padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#ddd'">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">📋 Modelo Formal</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.5;">
                                Prezados,<br>
                                Segue em anexo o relatório de pesagens solicitado...<br>
                                <em style="color: #999;">Clique para usar este modelo</em>
                            </div>
                        </div>
                        <div onclick="balanca.aplicarModeloPersonalizado('simples')" style="padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#ddd'">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">💼 Modelo Simples</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.5;">
                                Olá!<br>
                                Segue o relatório em anexo.<br>
                                <em style="color: #999;">Clique para usar este modelo</em>
                            </div>
                        </div>
                        <div onclick="balanca.aplicarModeloPersonalizado('detalhado')" style="padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#ddd'">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">📊 Modelo Detalhado</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.5;">
                                Relatório completo com resumo estatístico...<br>
                                <em style="color: #999;">Clique para usar este modelo</em>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ABA FAVORITOS -->
                <div id="email-tab-favoritos" class="email-tab-content" style="display: none;">
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: #333;">⭐ Emails Favoritos</h3>
                        <button type="button" id="btn-adicionar-favorito" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            ➕ Adicionar Email
                        </button>
                    </div>
                    <div id="email-favoritos-lista" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 40px; color: #999;">⭐ Nenhum email favoritado</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <style>
    /* Estilos para tabs de email */
    .email-tab.active {
        border-bottom: 3px solid #667eea !important;
        color: #667eea !important;
    }

    .email-tab:hover {
        background: #f8f9fa;
    }

    /* Estilos para chips de destinatários */
    .email-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
    }

    .email-chip-remove {
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        opacity: 0.8;
        transition: opacity 0.2s;
    }

    .email-chip-remove:hover {
        opacity: 1;
    }

    /* Efeito hover nos formatos */
    .formato-radio:has(input[type="radio"]:checked) {
        border-color: #667eea !important;
        background: #667eea10;
    }

    /* Scroll customizado para histórico/favoritos */
    #email-historico-lista::-webkit-scrollbar,
    #email-favoritos-lista::-webkit-scrollbar {
        width: 8px;
    }

    #email-historico-lista::-webkit-scrollbar-thumb,
    #email-favoritos-lista::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 4px;
    }
    </style>

    <!-- Aba: Monitor Firebase -->
    <div id="tab-content-monitor" class="tab-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">📊 Monitor de Consumo Firebase</h2>
        
        <!-- Card de Status -->
        <div class="bg-gradient-to-br from-orange-500 to-red-600 text-white rounded-xl shadow-2xl p-8 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-3xl font-bold mb-2">Leituras de Documentos</h3>
                    <p class="text-orange-100 text-sm">Monitoramento em tempo real • Sessão atual</p>
                </div>
                <div class="text-7xl opacity-20">
                    🔥
                </div>
            </div>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                    <p class="text-orange-100 text-xs uppercase tracking-wide mb-1">Total de Leituras</p>
                    <p class="text-5xl font-black" id="contador-leituras-total">0</p>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                    <p class="text-orange-100 text-xs uppercase tracking-wide mb-1">Iniciado em</p>
                    <p class="text-lg font-semibold" id="contador-inicio">-</p>
                </div>
            </div>
        </div>
        
        <!-- Cards de Leituras por Coleção -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Config -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border-t-4 border-blue-500">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="bg-blue-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <div class="text-right">
                            <p class="text-4xl font-black text-blue-600" id="contador-leituras-config">0</p>
                        </div>
                    </div>
                    <h4 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Configurações</h4>
                    <p class="text-xs text-gray-500 mt-1">app_state/config</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-600">Docs lidos</span>
                            <span class="text-xs font-bold text-blue-600" id="contador-leituras-config-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cadastros -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border-t-4 border-green-500">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="bg-green-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div class="text-right">
                            <p class="text-4xl font-black text-green-600" id="contador-leituras-cadastros">0</p>
                        </div>
                    </div>
                    <h4 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Cadastros</h4>
                    <p class="text-xs text-gray-500 mt-1">app_state/cadastros</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-600">Docs lidos</span>
                            <span class="text-xs font-bold text-green-600" id="contador-leituras-cadastros-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pendentes -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border-t-4 border-yellow-500">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="bg-yellow-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="text-right">
                            <p class="text-4xl font-black text-yellow-600" id="contador-leituras-pendentes">0</p>
                        </div>
                    </div>
                    <h4 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Pendentes</h4>
                    <p class="text-xs text-gray-500 mt-1">pesagensPendentes</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-600">Docs lidos</span>
                            <span class="text-xs font-bold text-yellow-600" id="contador-leituras-pendentes-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Completas -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border-t-4 border-teal-500">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="bg-teal-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="text-right">
                            <p class="text-4xl font-black text-teal-600" id="contador-leituras-completas">0</p>
                        </div>
                    </div>
                    <h4 class="text-sm font-bold text-gray-700 uppercase tracking-wide">Completas</h4>
                    <p class="text-xs text-gray-500 mt-1">pesagensCompletas</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-600">Docs lidos</span>
                            <span class="text-xs font-bold text-teal-600" id="contador-leituras-completas-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Informações e Dicas -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Info Card -->
            <div class="bg-gradient-to-br from-purple-50 to-blue-50 border-l-4 border-purple-500 rounded-lg p-6">
                <div class="flex items-start">
                    <div class="bg-purple-100 rounded-full p-3 mr-4">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-purple-900 mb-2">💡 Como Funciona</h3>
                        <ul class="text-sm text-purple-800 space-y-2">
                            <li>• <strong>Leitura</strong> = cada vez que o Firebase sincroniza dados</li>
                            <li>• Contadores incrementam a cada <strong>onSnapshot</strong></li>
                            <li>• Reinicia ao recarregar a página</li>
                            <li>• <strong>NÃO aumenta</strong> o consumo - apenas monitora</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Tips Card -->
            <div class="bg-gradient-to-br from-green-50 to-teal-50 border-l-4 border-green-500 rounded-lg p-6">
                <div class="flex items-start">
                    <div class="bg-green-100 rounded-full p-3 mr-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-green-900 mb-2">🚀 Dicas de Economia</h3>
                        <ul class="text-sm text-green-800 space-y-2">
                            <li>• Evite <strong>recarregar</strong> a página constantemente</li>
                            <li>• Use <strong>filtros de data</strong> nos relatórios</li>
                            <li>• Exporte dados <strong>quando necessário</strong></li>
                            <li>• Mantenha apenas dados <strong>relevantes</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
